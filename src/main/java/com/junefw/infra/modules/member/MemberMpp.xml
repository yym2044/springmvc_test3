<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.junefw.infra.modules.member.MemberMpp">

	<resultMap id="resultMapObj"
		type="com.junefw.infra.modules.member.Member"></resultMap>

	<select id="selectList" resultMap="resultMapObj">
		SELECT
			a.ifmmSeq
			, a.ifmmName
			, a.ifmmId
			, (select ifcdName from infrCode where ifcdSeq = a.ifmmGenderCd) as ifmmGenderName
			, a.ifmmDob
			, a.ifmmFavoriteColor
			, a.ifmmDelNy
			, (select ifcdName from infrCode where ifcdSeq = a.ifmmGradeCd) as ifmmGrade
			, a.ifmmRegDate
			, (select ifcdName from infrCode where ifcdSeq = a.ifmmStatusCd) as ifmmStatus
		FROM infrMember a
		
	</select>

	<select id="selectOne" resultMap="resultMapObj">
		SELECT DISTINCT
			a.ifmmSeq
			, a.ifmmName
			, a.ifmmId
			, (select ifcdName from infrCode where ifcdSeq = a.ifmmGenderCd) as ifmmGenderName
			, a.ifmmDob
			, a.ifmmFavoriteColor
			, a.ifmmDelNy
			, (select ifcdName from infrCode where ifcdSeq = a.ifmmGradeCd) as ifmmGrade
			, a.ifmmRegDate
			, (select ifcdName from infrCode where ifcdSeq = a.ifmmStatusCd) as ifmmStatus
			, if(a.ifmmEmailConsentNy=1,'수신동의','수신거부') as ifmmEmailConsentNyText
			, if(a.ifmmSmsConsentNy=1,'수신동의','수신거부') as ifmmSmsConsentNyText
			, if(a.ifmmPushConsentNy=1,'수신동의','수신거부') as ifmmPushConsentNyText
						
			, b.ifmeEmailFull
			
			, (select ifmpNumber from infrMemberPhone where ifmpDeviceCd = 26 and ifmmSeq = #{ifmmSeq}) as ifmpNumberMobile
			, (select ifmpNumber from infrMemberPhone where ifmpDeviceCd = 25 and  ifmmSeq = #{ifmmSeq}) as ifmpNumberHome
			
			, d.ifmaAddress1
			, d.ifmaAddress2
			
		FROM infrMember a
		LEFT JOIN infrMemberEmail b ON b.ifmmSeq = a.ifmmSeq AND b.ifmeDefaultNy = 1
		LEFT JOIN infrMemberPhone c ON c.ifmmSeq = a.ifmmSeq
		LEFT JOIN infrMemberAddress d ON d.ifmmSeq = a.ifmmSeq AND d.ifmaDefaultNy = 1
		WHERE
			1=1
		AND a.ifmmSeq = #{ifmmSeq}
	</select>
	
	<insert id="insert">
		INSERT INTO
		infrMember (
			ifmmSeq
			, ifmmName
			, ifmmId
			, ifmmPwd
			, ifmmGenderCd
			, ifmmDob
			, ifmmFavoriteColor
			, ifmmDelNy
			, ifmmGradeCd
			, ifmmRegDate
			, ifmmStatusCd
			, ifmmEmailConsentNy
			, ifmmSmsConsentNy
			, ifmmPushConsentNy
		) VALUES (
			#{ifmmSeq}
			, #{ifmmName}
			, #{ifmmId}
			, #{ifmmPwd}
			, #{ifmmGenderCd}
			, #{ifmmDob}
			, #{ifmmFavoriteColor}
			, 0
			, 76
			, #{ifmmRegDate}
			, 78
			, #{ifmmEmailConsentNy}
			, #{ifmmSmsConsentNy}
			, #{ifmmPushConsentNy}
		)
			
	</insert>
</mapper>